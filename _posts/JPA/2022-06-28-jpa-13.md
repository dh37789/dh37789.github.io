---
title:  "[JPA] 다양한 연관관계 매핑 (1)"

categories: JPA

toc: true
toc_sticky: true

date: 2022-06-28
last_modified_at: 2022-06-28
---

# 다양한 연관관계 매핑 (1)

연관관계는 매핑시 3가지를 고려해서 설계해야한다.

1. 다중성
2. 단방향, 양방향
3. 연관관계의 주인

## 종류

JPA의 연관관계의 대표적인 다중성 매핑방법은 아래와 같다.

- 다대일 : @ManyToOne
- 일대다 : @OneToMany
- 일대일 : @OneToOne
- 다대다 : @ManyToMany

보통 설계에서는 다대일을 주로 사용하고, 다대일을 통해 대부분의 문제를 해결할 수 있다.
하지만 **실무에서는 다대다의 관계는 쓰면 안된다.**

## 단방향, 양방향

- 테이블 
  - 외래 키 하나로 양쪽 조인 가능 
  - 사실 방향이라는 개념이 없음


- 객체
  - 참조용 필드가 있는 쪽으로만 참조 가능
  - 한쪽만 참조하면 단방향
  - 양쪽이 서로 참조하면 양방향

## 연관관계의 주인

- 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
- 객체 양방향 관계는 A->B, B->A 처럼 **참조가 2군데** 하지만 테이블은 참조가 하나이다.
- 객체 양방향 관계는 참조가 2군데 있음. 둘중 테이블의 외래 키를 관리할 곳을 지정해야함
- 연관관계의 주인(mappedBy) : 외래 키를 관리하는 참조
- 주인의 반대편 : 외래 키에 영향을 주지 않음, 단순 조회만 가능

## 다대일 (N:1)

무조건 외래키는 다의 관계를 가진 곳에 외래키나 참조를 관리한다.

![다대일]({{site.url}}/assets/image/2022-06-28/jpa001.png)

기존에 작성한 예시의 @ManyToOne이 다대일에 해당한다.

```java
@Entity
@Getter @Setter
public class Member {

    @Id @GeneratedValue
    private long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}

```

```java
@Entity
@Getter @Setter
public class Team {

    @Id @GeneratedValue
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<>();

    public void addMember(Member member) {
        members.add(member);
        member.setTeam(this);
    }
}
```

## 다대일 정리

- 가장 많이 사용하는 연관관계
- 다대일의 반대는 일대다
- 다수쪽에 보통 외래키의 참조를 넣는다.