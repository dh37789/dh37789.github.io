---
title: "[Docker] 도커 실행하기"

categories: Docker

toc: true
toc_sticky: Docker

date: 2023-01-22
last_modified_at: 2023-01-22
---

# 도커 설치하기

## 설치하기

### Linux

리눅스에서는 아래의 명령어를 입력하고 패스워드를 입력하면 리눅스의 배포판에 따라 자동으로 최신버전의 도커를 설치한다.

이후 `sudo usermod`를 통해 유저 권한을 넣어준다.

```shell
curl -s https://get.docker.com/ | sudo shift 

sudo usermod -aG docker ubuntu
```

### Windows, MacOS

Windows와 MacOS 환경에서는 도커에서 공식으로 제공하는 프로그램 Docker Desktop을 설치하여 쉽게 사용이 가능하다.

![docker4]({{site.url}}//assets/image/2023/2023-01/22-docker004.png)


- 도커는 기본적으로 linux를 지원하기 떄문에 MacOS와 Windows에 설치되는 Docker는 가상머신에 설치된다.
- MacOS는 xhyve를 사용하고 Windows는 Hyper-V를 사용


### 설치 확인하기

`docker version` 의 명령어를 입력하면 아래의 설치정보를 확인할 수 있다.

```shell
PS C:\Users\dhaud> docker version

Client:
 Cloud integration: v1.0.29
 Version:           20.10.22
 API version:       1.41
 Go version:        go1.18.9
 Git commit:        3a2c30b
 Built:             Thu Dec 15 22:36:18 2022
 OS/Arch:           windows/amd64
 Context:           default
 Experimental:      true

Server: Docker Desktop 4.16.2 (95914)
 Engine:
  Version:          20.10.22
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.18.9
  Git commit:       42c8b31
  Built:            Thu Dec 15 22:26:14 2022
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.6.14
  GitCommit:        9ba4b250366a5ddde94bb7c9d1def331423aa323
 runc:
  Version:          1.1.4
  GitCommit:        v1.1.4-0-g5fd4c4d
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
```


그런데 출력된 로그를 보면 버전의 종류가 두가지가 뜨는 것을 확인 할 수 있는데.

이는 Docker가 client, server 구조로 되어있다는 것을 알 수 있다.

![docker4]({{site.url}}//assets/image/2023/2023-01/22-docker005.png)


Docker Client(power shell, brew..)에서 `docker build`, `docker run` 과 같은 명령어를 입력하면 HOST 서버의 Docker Daemon에서 Docker API 요청을 수신하여 실행되고 있는 이미지 및 컨테이너를 관리하는 구조로 되어있다.

자세한 도커의 아키텍쳐의 경우 아래의 공식문서에서 확인할 수 있다.

[Docker Document - 도커 개요](https://docs.docker.com/get-started/overview/)


## 도커 기본 명령어

### run - 컨테이너 실행

```shell
docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]
```

### [OPTIONS]

| 옵션        | description                       |
|------------|-----------------------------------|
| -d         | detached mode (백그라운드 모드)          |
| -p         | 호스트와 컨테이너의 포트를 연결                 |
| -v         | 호스트와 컨테이너의 디렉토리를 연결               |
| -e         | 컨테이너 내에서 사용할 환경변수 설정              |
| --name     | 컨테이너 이름 설정                        |
| --rm       | 프로세스 종료시 컨테이너 자동 제거               |
| -it        | -i와 -t를 동시에 사용한 것으로 터미널 입력을 위한 옵션 |
| --network  | 네트워크 연결                           |


### run 실습

아래의 명령어를 통해 우분투의 컨테이너를 실행시켜보자.

ubuntu의 이미지를 다운받지 않았기 때문에, 다운로드 받고나서 해당 컨테이너를 실행한다.


```shell
PS C:\Users\dhaud> docker run ubuntu:20.04

Unable to find image 'ubuntu:20.04' locally
20.04: Pulling from library/ubuntu
846c0b181fff: Pull complete
Digest: sha256:0e0402cd13f68137edb0266e1d2c682f217814420f2d43d300ed8f65479b14fb
Status: Downloaded newer image for ubuntu:20.04
```

Docker desktop을 보면 우분투의 컨테이너가 실행된것을 확인 할 수 있다.


![docker5]({{site.url}}//assets/image/2023/2023-01/23-docker001.png)


위의 명령어를 입력했을때 우분투가 바로 죽는 이유는 별다른 명령어를 입력하지 않았기 때문이다.

이제 옵션 및 명령어를 추가하여 입력해보자.

아래의 명령어에 몇가지 옵션을 추가하면 우분투가 실행된 것을 확인할 수 있고, 우분투의 명령어가 먹히는것을 볼수 있다. 

```shell
PS C:\Users\dhaud> docker run --rm -it ubuntu:20.04 /bin/sh
#
# ls
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
# cat /etc/issue
Ubuntu 20.04.5 LTS \n \l
```

`# exit` 를 통해 ubuntu를 종료할 시 `--rm`의 옵션으로 컨테이너가 삭제 된다. 만약 해당 옵션을 주지 않을시 수동으로 종료해줘야 한다.


이제 좀더 재미있는 실습을 해보자. 

`hashicorp/http-echo` 라는 라이브러리를 이용해 간단한 웹서버를 띄우고 해당 페이지를 호출해볼 것이다.

> hashicorp/http-echo : 간단한 HTML 페이지 콘텐츠를 만드는 라이브러리

5678의 포트를 가지고 hello world를 반환하는 간단한 웹페이지를 만들었다.

```shell
docker run --rm -p 5678:5678 hashicorp/http-echo -text="hello world"
```

아래의 이미지를 다운로드 받는 과정을 거쳐 서버를 띄우는 로그가 확인 된다.


```shell
Unable to find image 'hashicorp/http-echo:latest' locally
latest: Pulling from hashicorp/http-echo
86399148984b: Pull complete
Digest: sha256:ba27d460cd1f22a1a4331bdf74f4fccbc025552357e8a3249c40ae216275de96
Status: Downloaded newer image for hashicorp/http-echo:latest
2023/01/23 07:07:54 Server is listening on :5678
```


이제 또하나의 cmd를 시작해서 `curl` 명령어로 해당 웹페이지를 호출해보자.

아래 hello world의 컨텐츠를 반환한는 것을 확인 할 수 있다.

```shell
PS C:\Users\dhaud> curl http://localhost:5678

StatusCode        : 200
StatusDescription : OK
Content           : hello world

RawContent        : HTTP/1.1 200 OK
                    X-App-Name: http-echo
                    X-App-Version: 0.2.3
                    Content-Length: 12
                    Content-Type: text/plain; charset=utf-8
                    Date: Mon, 23 Jan 2023 07:09:40 GMT

                    hello world

Forms             : {}
Headers           : {[X-App-Name, http-echo], [X-App-Version, 0.2.3], [Content-Length, 12], [Content-Type, text/plain;
                    charset=utf-8]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 12
```





