---
title: "[Docker] 도커 이미지"

categories: Docker

toc: true
toc_sticky: Docker

date: 2023-02-10
last_modified_at: 2023-02-10
---

# 도커 이미지

이번 포스트에는 도커의 컨테이너를 실행하는데 필요한 이미지에 대해서 알아보고, 만들어보고자 한다.

## 이미지란?

이미지는 컨테이너가 실행되는데 필요한 파일들(서버 프로그램, 소스코드 및 라이브러리, 컴파일된 실행파일 등등..)을 묶은 형태를 말한다.

프로세스를 실행하기 위한 모든 파일과 설정값(환경)을 지님으로써, 더이상 서버구동에 의존되는 파일을 설치할 필요가 없다. 

프로세스는 이미지의 환경(파일)을 변경할 수 있으며, 이 변경된 환경을 저장해서 새로운 이미지를 생성할 수있다. 

### 특징

- 도커 이미지의 용량은 보통 수백 MB ~ 수 G 이다. 하지만 가상머신보다 용량이 작다.
- 이미지의 상태 값은 변하지 않는 (immutable) 값이다.
- 하나의 이미지는 여러 컨테이너를 생성할 수 있고, 컨테이너가 삭제되더라도 이미지는 변하지않고 남아있다.
- 다양한 API가 제공되어 마음껏 자동화가 가능하다.
- 도커에서는 DockerFile이라는 파일을 이용해 이미지를 만든다. DockerFile에는 소스와 함께 의존성 패키지를 사용했던 설정 파일을 버전 관리하기 쉽도록 명시되어 진다.

## 레이어드 파일 시스템 (layered file system)

처음에는 이미지의 환경(파일)을 변경할 수 있다고 했지만, 특징에서는 이미지의 상태 값은 또 immutable로 변하지 않는다고 하였다. 앞뒤가 안맞다?

아니다. 이것은 도커의 특징으로, 내부 상태를 변경하는 것이 아니라, 새로운 환경을 추가해 이미지를 만드는것을 말한다.

도커의 이미지는 읽기 전용 영역(Read only layer)과 쓰기 가능 영역(Readable/Writable layer)으로 나누어 진다.

예를들어, 처음 ubuntu의 이미지를 실행시킨다고 하자.

```shell
docker run ubuntu
```

그렇다면 ubuntu의 내부 설정은 변경할 수 없지만, ubuntu에 MySql을 추가하거나, Git을 추가하는 방식으로 새롭게 이미지를 커스텀 할 수 있다.

![docker1]({{site.url}}//assets/image/2023/2023-02/10-docker001.png)


만약에 사용자가 Container Layer 단계에서 종료할 경우 추가한 새로운 리소스는 삭제가 된다.

만약 작업하던 내용을 이미지로 덧씌어 새로운 이미지로 만들기 위해서는 `docker commit`을 이용해 새로운 커스텀 이미지를 생성 할 수 있다.

